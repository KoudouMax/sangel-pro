{% set cover_field = content.field_cover ?? null %}
{% set cover_markup = cover_field ? cover_field|render : '' %}
{% set has_cover = cover_markup|trim is not empty %}

{% set node_url = path('entity.node.canonical', {'node': node.id()}) %}
{% set client_type_entity = node.hasField('field_client_type') and node.field_client_type.entity ? node.field_client_type.entity : null %}
{% set client_type_tid = client_type_entity ? client_type_entity.id() : 0 %}
{% set product_count = client_type_tid ? product_count_by_client_type(client_type_tid) : 0 %}
{% set client_type = node.hasField('field_client_type') and node.field_client_type.entity ? node.field_client_type.entity.label() : '' %}

{% set classes = [
  'sangel-catalog-card',
  'overflow-hidden',
  'rounded-3xl',
  'border',
  'border-sangel-ice-strong',
  'bg-white',
  'shadow-lg',
  'transition',
  'hover:-translate-y-1',
  'hover:shadow-xl'
] %}

{% set link_attributes = {
  'href': node_url,
  'class': 'group block focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sangel-primary/30 focus-visible:ring-offset-2 focus-visible:ring-offset-white'
} %}

<article{{attributes.addClass(classes)}}>
	<a{{create_attribute(link_attributes)}}>
		<div class="relative">
			<div class="aspect-[3/2] overflow-hidden bg-sangel-ice">
				{% if has_cover %}
					<div class="h-full w-full object-cover">
						{{ cover_markup }}
					</div>
				{% else %}
					<div class="flex h-full w-full items-center justify-center text-sm font-semibold text-sangel-text/50">
						{{ label }}
					</div>
				{% endif %}
			</div>
			<div class="absolute inset-0 bg-gradient-to-t from-sangel-text/80 via-sangel-text/10 to-transparent transition-opacity group-hover:opacity-90"></div>
			<div class="absolute inset-x-0 bottom-0 p-6 text-white">
				<h3 class="text-lg font-semibold leading-tight">
					{{ label }}
				</h3>
				{% if client_type %}
					<p class="mt-1 text-xs font-medium uppercase tracking-[0.3em] text-white/70">{{ client_type }}</p>
				{% endif %}
			</div>
		</div>

		<div class="flex items-center justify-between gap-4 px-6 py-4 text-sm text-sangel-text/70">
			<div class="flex items-center gap-3">
				<span class="inline-flex items-center gap-2 rounded-full bg-sangel-ice px-3 py-1 text-xs font-semibold text-sangel-primary">
					{{ product_count }}
					<span class="text-sangel-text/60">{{ 'produits'|t }}</span>
				</span>
			</div>
			<span class="inline-flex items-center gap-2 text-sangel-primary transition group-hover:translate-x-1 group-hover:text-sangel-primary-dark">
				{{ 'Voir le catalogue'|t }}
				<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewbox="0 0 24 24" stroke-width="1.6" stroke="currentColor" aria-hidden="true">
					<path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12l-7.5 7.5M21 12H3"/>
				</svg>
			</span>
		</div>
	</a>

	{% if content.links %}
		<div class="hidden">
			{{ content.links }}
		</div>
	{% endif %}
</article>

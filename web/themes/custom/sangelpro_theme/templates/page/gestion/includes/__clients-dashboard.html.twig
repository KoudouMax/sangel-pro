{% set section_identifier = identifier ?? 'manage-clients-account' %}
{% set selected = selected_client ?? {} %}
{{ attach_library('sangelpro_theme/manage-clients') }}

<section class="mx-auto max-w-7xl space-y-10" data-manage-clients data-sangel-core-placeholder="{{ section_identifier }}" data-empty-text="{{ 'Aucun client ne correspond à votre recherche actuelle.'|t }}">
	<div class="grid gap-8 lg:grid-cols-[minmax(0,1fr)_380px] xl:grid-cols-[minmax(0,1fr)_420px]">
		<div class="space-y-6">
			<div class="grid gap-4 grid-cols-1 sm:grid-cols-3">
				<div class="rounded-2xl border border-sangel-ice bg-white p-5 shadow-sm">
					<div class="text-xs uppercase tracking-[0.3em] text-sangel-text/50">{{ 'Total clients'|t }}</div>
					<div class="mt-2 text-3xl font-semibold text-sangel-text">{{ clients_summary.total }}</div>
				</div>
				<div class="rounded-2xl border border-sangel-ice bg-white p-5 shadow-sm">
					<div class="text-xs uppercase tracking-[0.3em] text-sangel-text/50">{{ 'Actifs'|t }}</div>
					<div class="mt-2 flex items-baseline gap-2 text-3xl font-semibold text-sangel-primary">
						{{ clients_summary.active }}
						{% if clients_summary.total %}
							<span class="text-xs font-semibold text-sangel-text/40">
								{{ '(@percent%)'|t({'@percent': (clients_summary.active / clients_summary.total * 100)|round(0, 'floor') }) }}
							</span>
						{% endif %}
					</div>
				</div>
				<div class="rounded-2xl border border-sangel-ice bg-white p-5 shadow-sm">
					<div class="text-xs uppercase tracking-[0.3em] text-sangel-text/50">{{ 'Inactifs'|t }}</div>
					<div class="mt-2 flex items-baseline gap-2 text-3xl font-semibold text-orange-500">
						{{ clients_summary.inactive }}
						{% if clients_summary.total %}
							<span class="text-xs font-semibold text-sangel-text/40">
								{{ '(@percent%)'|t({'@percent': (clients_summary.inactive / clients_summary.total * 100)|round(0, 'floor') }) }}
							</span>
						{% endif %}
					</div>
				</div>
			</div>

			<div class="rounded-2xl border border-sangel-ice bg-gradient-to-r from-white to-sangel-ice/40 p-6 shadow-sm">
				<div class="flex flex-col gap-4 justify-around">
					<div class="space-y-1">
						<h2 class="text-lg font-semibold text-sangel-text">{{ 'Actions rapides'|t }}</h2>
						<p class="text-sm text-sangel-text/70">{{ 'Ajoutez un nouveau client, importez des produits ou accédez à vos catalogues en un clic.'|t }}</p>
					</div>
					<div class="flex flex-wrap gap-3">
						<a href="{{ create_client_url }}" class="inline-flex items-center gap-2 rounded-full bg-sangel-primary px-6 py-2 text-xs font-semibold text-white shadow transition hover:bg-sangel-primary/90 focus:outline-none focus:ring-2 focus:ring-sangel-primary/30">
							<span aria-hidden="true">＋</span>
							{{ 'Créer un client'|t }}
						</a>
						<a href="{{ import_feed_url }}" class="inline-flex items-center gap-2 rounded-full border border-sangel-primary px-6 py-2 text-xs font-semibold text-sangel-primary transition hover:bg-sangel-primary/10 focus:outline-none focus:ring-2 focus:ring-sangel-primary/30">
							<span aria-hidden="true">⇪</span>
							{{ 'Importer des produits'|t }}
						</a>
						<a href="{{ catalog_overview_url }}" class="inline-flex items-center gap-2 rounded-full border border-sangel-ice px-6 py-2 text-xs font-semibold text-sangel-text/80 transition hover:border-sangel-primary hover:text-sangel-primary focus:outline-none focus:ring-2 focus:ring-sangel-primary/20">
							{{ 'Voir les catalogues'|t }}
						</a>
					</div>
				</div>
			</div>

			{% if clients %}
				<div class="rounded-3xl border border-sangel-ice bg-white shadow-sm overflow-hidden" data-client-list-wrapper>
					<div class="flex flex-col gap-4 border-b border-sangel-ice/60 p-6">
						<div class="relative flex-1">
							<label for="client-search" class="sr-only">{{ 'Recherche'|t }}</label>
							<input id="client-search" name="client-search" type="search" placeholder="{{ 'Rechercher un client, une entreprise, un email…'|t }}" class="w-full rounded-full border border-sangel-ice px-5 py-2 text-sm text-sangel-text/80 shadow focus:border-sangel-primary focus:outline-none focus:ring-2 focus:ring-sangel-primary/40" data-role="search">
							<span class="pointer-events-none absolute inset-y-0 right-4 flex items-center text-sangel-text/40" aria-hidden="true">⌕</span>
						</div>


						{% set filter_button_base = 'inline-flex items-center gap-2 rounded-full border border-sangel-ice px-4 py-1 text-xs font-semibold text-sangel-text/60 transition hover:border-sangel-primary hover:text-sangel-primary focus:outline-none focus:ring-2 focus:ring-sangel-primary/20' %}
						{% set filter_active_classes = 'border-sangel-primary bg-sangel-primary/10 text-sangel-primary ring-2 ring-sangel-primary/20' %}
						<div class="flex flex-wrap gap-3">
							<button type="button" class="{{ filter_button_base }} {{ filter_active_classes }}" data-role="status-filter" data-status="all" aria-pressed="true" data-active-classes="{{ filter_active_classes }}">{{ 'Tous les statuts'|t }}</button>
							<button type="button" class="{{ filter_button_base }}" data-role="status-filter" data-status="published" aria-pressed="false" data-active-classes="{{ filter_active_classes }}">{{ 'Actifs'|t }}</button>
							<button type="button" class="{{ filter_button_base }}" data-role="status-filter" data-status="unpublished" aria-pressed="false" data-active-classes="{{ filter_active_classes }}">{{ 'En veille'|t }}</button>
							{% if client_type_filters %}
								<div class="relative">
									<label for="client-type-filter" class="sr-only">{{ 'Type de client'|t }}</label>
									<select id="client-type-filter" class="rounded-full border border-sangel-ice bg-white px-4 py-1 pr-10 text-xs font-semibold text-sangel-text/60 transition focus:border-sangel-primary focus:text-sangel-primary focus:outline-none focus:ring-2 focus:ring-sangel-primary/20" data-role="type-filter">
										<option value="">{{ 'Type de client'|t }}</option>
										{% for type in client_type_filters %}
											<option value="{{ type.id }}">{{ type.label }}</option>
										{% endfor %}
									</select>
								</div>
							{% endif %}
						</div>
					</div>
					<div class="overflow-auto">
						<table class="min-w-full divide-y divide-sangel-ice text-left text-sm" data-role="table">
							<thead class="bg-sangel-ice-light text-xs font-semibold uppercase tracking-widest text-sangel-text/60">
								<tr>
									<th scope="col" class="px-6 py-3">{{ 'Client'|t }}</th>
									<th scope="col" class="px-6 py-3">{{ 'Contact'|t }}</th>
									<th scope="col" class="px-6 py-3">{{ 'Type'|t }}</th>
									<th scope="col" class="px-6 py-3 text-right">{{ 'Mis à jour'|t }}</th>
									<th scope="col" class="px-6 py-3 text-right">{{ 'Actions'|t }}</th>
								</tr>
							</thead>
							<tbody class="divide-y divide-sangel-ice/70" data-role="rows">
								{% for client in clients %}
									{% set client_json = client|json_encode|escape('html') %}
									{% set is_selected = selected.id is defined and selected.id and client.id == selected.id %}
									<tr class="cursor-pointer transition hover:bg-sangel-primary/5" data-client-row data-status="{{ client.status }}" data-client='{{ client|json_encode|raw }}' {% if client.client_type_ids %} data-client-types="{{ client.client_type_ids|join(',') }}" {% endif %} {% if is_selected %} data-selected="true" {% endif %} data-active-classes="bg-sangel-primary/10 border border-sangel-primary/10 shadow-inner">
										<td class="px-6 py-4">
											<div class="space-y-1">
												<div class="flex items-center gap-2">
													<span class="font-semibold text-sangel-text">{{ client.title }}</span>
													<span class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold {{ client.status == 'published' ? 'bg-sangel-primary/10 text-sangel-primary border border-sangel-primary/10' : 'bg-sangel-ice text-sangel-text/50' }}" data-role="status-pill" data-active-classes="bg-sangel-primary/10 text-sangel-primary border border-sangel-primary/10">{{ client.status_label }}</span>
												</div>
												{% if client.company %}
													<div class="text-xs text-sangel-text/60">{{ client.company }}</div>
												{% endif %}
											</div>
										</td>
										<td class="px-6 py-4 text-xs text-sangel-text/70">
											{% if client.email %}
												<div class="flex items-center gap-2">
													<span class="font-semibold text-sangel-text">{{ client.owner_name|default(client.email) }}</span>
												</div>
												<div>{{ client.email }}</div>
											{% endif %}
											{% if client.phone %}
												<div class="text-sangel-text/60">{{ client.phone }}</div>
											{% endif %}
										</td>
										<td class="px-6 py-4 text-xs text-sangel-text/70">
											{% if client.client_type %}
												{{ client.client_type }}
											{% else %}
												<span class="text-sangel-text/40">{{ 'Non défini'|t }}</span>
											{% endif %}
										</td>
										<td class="px-6 py-4 text-right text-xs text-sangel-text/60">
											<div>{{ client.updated }}</div>
											{% if client.owner_last_access %}
												<div class="text-[10px] uppercase tracking-wider text-sangel-text/40">{{ 'Dernière connexion : @date'|t({'@date': client.owner_last_access}) }}</div>
											{% endif %}
										</td>
										<td class="px-6 py-4">
											<div class="flex flex-wrap justify-end gap-2">
												{% if client.catalog_url %}
													<a href="{{ client.catalog_url }}" class="inline-flex items-center justify-center rounded-full border border-sangel-ice px-3 py-1.5 text-xs font-semibold text-sangel-text/70 transition hover:border-sangel-primary hover:text-sangel-primary focus:outline-none focus:ring-2 focus:ring-sangel-primary/20" data-client-action="catalog">{{ 'Catalogues'|t }}</a>
												{% endif %}
												{% if client.cart_url %}
													<a href="{{ client.cart_url }}" class="inline-flex items-center justify-center rounded-full border border-sangel-ice px-3 py-1.5 text-xs font-semibold text-sangel-text/70 transition hover:border-sangel-primary hover:text-sangel-primary focus:outline-none focus:ring-2 focus:ring-sangel-primary/20" data-client-action="cart">{{ 'Panier'|t }}</a>
												{% endif %}
												{% if client.orders_url %}
													<a href="{{ client.orders_url }}" class="inline-flex items-center justify-center rounded-full border border-sangel-ice px-3 py-1.5 text-xs font-semibold text-sangel-text/70 transition hover:border-sangel-primary hover:text-sangel-primary focus:outline-none focus:ring-2 focus:ring-sangel-primary/20" data-client-action="orders">{{ 'Commandes'|t }}</a>
												{% endif %}
												<div>
													<a href="{{ client.edit_url }}" class="inline-flex items-center justify-center rounded-full bg-sangel-primary px-3 py-1.5 text-xs font-semibold text-white transition hover:bg-sangel-primary/90 focus:outline-none focus:ring-2 focus:ring-sangel-primary/20" data-client-action="edit">{{ 'Modifier'|t }}</a>
													<a href="{{ client.delete_url }}" class="inline-flex items-center justify-center rounded-full border border-red-200 px-3 py-1.5 text-xs font-semibold text-red-500 transition hover:border-red-500 hover:text-red-600 focus:outline-none focus:ring-2 focus:ring-red-300" data-client-action="delete">{{ 'Supprimer'|t }}</a>
												</div>
											</div>
										</td>
									</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
					<div class="border-t border-sangel-ice/70 p-6 text-sm text-sangel-text/60 hidden" data-role="no-results">
						{{ 'Aucun client ne correspond à votre recherche actuelle.'|t }}
					</div>
				</div>
			{% else %}
				<div class="rounded-3xl border border-dashed border-sangel-ice bg-white/70 p-12 text-center shadow-sm">
					<h2 class="text-2xl font-semibold text-sangel-text/80">{{ 'Aucun client pour le moment'|t }}</h2>
					<p class="mt-3 text-sm text-sangel-text/60">{{ 'Ajoutez votre premier client pour commencer le suivi du profil et de son panier.'|t }}</p>
					<div class="mt-6 inline-flex">
						<a href="{{ create_client_url }}" class="inline-flex items-center justify-center rounded-full bg-sangel-primary px-6 py-3 text-sm font-semibold text-white shadow transition hover:bg-sangel-primary/90 focus:outline-none focus:ring-2 focus:ring-sangel-primary/30">{{ 'Créer un client'|t }}</a>
					</div>
				</div>
			{% endif %}
		</div>

		<aside class="space-y-6">
			{% if selected %}
				<div class="rounded-2xl border border-sangel-ice bg-white p-6 shadow-sm" data-client-panel>
					<div class="flex items-start justify-between gap-4">
						<div>
							<h2 class="text-lg font-semibold text-sangel-text" data-client-field="title">{{ selected.title|default('') }}</h2>
							<p class="text-sm text-sangel-text/70 {% if selected.company is empty %}hidden{% endif %}" data-client-field="company-wrapper">
								<span data-client-field="company">{{ selected.company|default('') }}</span>
							</p>
						</div>
						<span class="inline-flex items-center rounded-full px-3 py-1 text-[0.65rem] font-semibold uppercase tracking-[0.22em] {{ selected.status|default('') == 'published' ? 'bg-sangel-primary/10 text-sangel-primary border border-sangel-primary/10' : 'bg-sangel-ice text-sangel-text/50' }}" data-client-field="status-label">{{ selected.status_label|default('') }}</span>
					</div>
					<dl class="mt-5 space-y-4 text-sm text-sangel-text/70">
						<div class="flex items-start justify-between gap-4 {% if selected.owner_name is empty %}hidden{% endif %}" data-client-field="contact-wrapper">
							<dt class="font-semibold text-sangel-text/80">{{ 'Contact'|t }}</dt>
							<dd class="text-right">
								<div class="text-sangel-text" data-client-field="contact-name">{{ selected.owner_name|default('') }}</div>
								<div class="text-xs text-sangel-text/60 {% if selected.email is empty %}hidden{% endif %}" data-client-field="email-wrapper">
									<span data-client-field="email">{{ selected.email|default('') }}</span>
								</div>
								<div class="text-xs text-sangel-text/60 {% if selected.phone is empty %}hidden{% endif %}" data-client-field="phone-wrapper">
									<span data-client-field="phone">{{ selected.phone|default('') }}</span>
								</div>
							</dd>
						</div>
						<div class="flex items-start justify-between gap-4">
							<dt class="font-semibold text-sangel-text/80">{{ 'Type'|t }}</dt>
							<dd class="text-right">
								{% if selected.client_type %}
									<span data-client-field="type">{{ selected.client_type }}</span>
								{% else %}
									<span class="text-sangel-text/40" data-client-field="type-empty">{{ 'Non défini'|t }}</span>
								{% endif %}
							</dd>
						</div>
						<div class="flex items-start justify-between gap-4">
							<dt class="font-semibold text-sangel-text/80">{{ 'Créé le'|t }}</dt>
							<dd class="text-right text-xs text-sangel-text/60" data-client-field="created">{{ selected.created|default('') }}</dd>
						</div>
						<div class="flex items-start justify-between gap-4">
							<dt class="font-semibold text-sangel-text/80">{{ 'Mis à jour'|t }}</dt>
							<dd class="text-right text-xs text-sangel-text/60" data-client-field="updated">{{ selected.updated|default('') }}</dd>
						</div>
						<div class="flex items-start justify-between gap-4 {% if selected.owner_last_access is empty %}hidden{% endif %}" data-client-field="last-access-wrapper">
							<dt class="font-semibold text-sangel-text/80">{{ 'Dernière connexion'|t }}</dt>
							<dd class="text-right text-xs text-sangel-text/60" data-client-field="last-access">{{ selected.owner_last_access|default('') }}</dd>
						</div>
					</dl>
					<div class="mt-6 space-y-3">

						<a href="{{ selected.view_url|default('#') }}" class="inline-flex w-full items-center justify-between rounded-full border border-sangel-ice px-4 py-3 text-sm font-semibold text-sangel-text transition hover:border-sangel-primary hover:text-sangel-primary focus:outline-none focus:ring-2 focus:ring-sangel-primary/20 {% if selected.view_url is empty %}pointer-events-none opacity-60{% endif %}" data-client-link="view">
							<span>{{ 'Voir la fiche client'|t }}</span>
							<span aria-hidden="true">›</span>
						</a>
						<a href="{{ selected.cart_url|default('#') }}" class="inline-flex w-full items-center justify-between rounded-full border border-sangel-ice px-4 py-3 text-sm font-semibold text-sangel-text transition hover:border-sangel-primary hover:text-sangel-primary focus:outline-none focus:ring-2 focus:ring-sangel-primary/20 {% if selected.cart_url is empty %}hidden{% endif %}" data-client-link="cart">
							<span>{{ 'Accéder au panier du client'|t }}</span>
							<span aria-hidden="true">›</span>
						</a>
						<a href="{{ selected.orders_url|default('#') }}" class="inline-flex w-full items-center justify-between rounded-full border border-sangel-ice px-4 py-3 text-sm font-semibold text-sangel-text transition hover:border-sangel-primary hover:text-sangel-primary focus:outline-none focus:ring-2 focus:ring-sangel-primary/20 {% if selected.orders_url is empty %}hidden{% endif %}" data-client-link="orders">
							<span>{{ 'Historique de commandes'|t }}</span>
							<span aria-hidden="true">›</span>
						</a>
						<a href="{{ selected.catalog_url|default('#') }}" class="inline-flex w-full items-center justify-between rounded-full border border-sangel-ice px-4 py-3 text-sm font-semibold text-sangel-text transition hover:border-sangel-primary hover:text-sangel-primary focus:outline-none focus:ring-2 focus:ring-sangel-primary/20 {% if selected.catalog_url is empty %}hidden{% endif %}" data-client-link="catalog">
							<span>{{ 'Catalogue personnalisé'|t }}</span>
							<span aria-hidden="true">›</span>
						</a>
						<div class="flex flex-col gap-3 pt-1 sm:flex-row">
							<a href="{{ selected.edit_url|default('#') }}" class="inline-flex w-full items-center justify-center rounded-full bg-sangel-primary px-4 py-2 text-xs font-semibold text-white shadow transition hover:bg-sangel-primary/90 focus:outline-none focus:ring-2 focus:ring-sangel-primary/30 {% if selected.edit_url is empty %}pointer-events-none opacity-60{% endif %}" data-client-link="edit">{{ 'Modifier'|t }}</a>
							<a href="{{ selected.delete_url|default('#') }}" class="inline-flex w-full items-center justify-center rounded-full border border-red-200 px-4 py-2 text-xs font-semibold text-red-500 transition hover:border-red-500 hover:text-red-600 focus:outline-none focus:ring-2 focus:ring-red-300 {% if selected.delete_url is empty %}pointer-events-none opacity-60{% endif %}" data-client-link="delete">{{ 'Supprimer'|t }}</a>
						</div>
					</div>
				</div>
			{% endif %}
			<div class="hidden rounded-2xl border border-dashed border-sangel-ice bg-white/70 p-8 text-center text-sm text-sangel-text/60 shadow-sm" data-client-panel-empty>
				<p>{{ 'Sélectionnez un client dans la liste pour afficher les informations de profil et accéder à son panier.'|t }}</p>
			</div>
		</aside>
	</div>
</section>
